var spiceforms,spiceGeo;Date.now||(Date.now=function(){return(new Date).getTime()});spiceforms=function(){function t(n){return document.querySelector(n)}function n(n){return document.getElementById(n)}function o(){var n="";return[].forEach.call(e,function(t){n+=t.value!==null?t.value:t.innerText}),n}function f(n,t){n.style.background=t}function y(){s=!0;h=o();i=!1;var c=t("form"),e=new XMLHttpRequest;e.open("POST",v);try{e.send(new FormData(c))}catch(y){n("submit").className=""}e.onreadystatechange=function(){var i,o,t,h;if(e.readyState===4){if(s=!1,r=!1,u=!1,i=n("netwerr"),e.status!==200){n("submit").className="";o=e.responseText;i.textContent=o!==null&&o!==""?o:"Ooops, we were unable to automatically save your changes. Check your internet connection and click the save-button to try again.";i.style.display="";return}i.style.display="none";t=JSON.parse(e.responseText);t.status==="ok"?r=!0:t.status==="full"?u=!0:t.status==="incomplete";h=!1;try{t.fields.forEach(function(t){var r=n(t.id),u=r.parentNode,e=n(t.id+"_val"),i;t.valid?(f(u,""),r.removeAttribute("aria-invalid"),e!==null&&(e.style.display="none")):r===l&&(r.setAttribute("aria-invalid","true"),f(u,"#F8D3FF"),e!==null&&(e.style.display=""));t.changed&&t.valid&&(h=!0,i=n(t.id+"_sh"),i.textContent="saved.",f(u,"#b8ffed"),i.dataset.changedguid=t.changedGUid,setTimeout(function(){i.dataset.changedguid===t.changedGUid&&(i.textContent="",f(u,""))},1e4))})}catch(c){}h&&(a=!0,p())}}}function p(){if(a){var n="",i="",f="";u?(n="hd",i="hd",f="i",t("#full").setAttribute("role","alert")):r?(i="hd",f="hd",n="i",t("#almostcomplete").setAttribute("role","alert")):(n="hd",i="w",f="hd",t("#incwn").setAttribute("role","alert"));t("#almostcomplete").className=n;t("#full").className=f;t("#incwn").className=i}}function b(t){try{var i=n(t.dataset.help);i.className=""}catch(r){}}function k(t){try{var i=n(t.dataset.help);i.className="hd"}catch(r){}}function w(t){c=Date.now();i=!0;var r=t.target,u=n(r.id+"_sh");u.textContent=""}var e;document.addEventListener||(document.getElementById("submit").className="");e=document.querySelectorAll("input,textarea");var c=Date.now(),i=!1,s=!1,r=!1,u=!1,l,h=o(),a=!1,v;return n("validfromserver")!==null&&(r=!0),n("completefromserver")!==null&&(u=!0),[].forEach.call(e,function(n){n.addEventListener("blur",function(n){l=n.target;p();k(n.target)});n.addEventListener("focus",function(n){b(n.target)})}),t("form").addEventListener("change",function(n){w(n)}),t("form").addEventListener("keyup",function(n){w(n)}),setInterval(function(){var n=o();n!==h&&(i=!0,h=n)},1e3),setInterval(function(){i&&!s&&Date.now()-c>250&&y()},100),{PostUserFormAjax:y,SetPostUrl:function(n){v=n}}}(),function(){var n="modernizr";try{localStorage.setItem(n,n);localStorage.removeItem(n)}catch(t){document.getElementById("storeurl").className=""}}();spiceforms.SetPostUrl("/User/_PrivateUserPageAjax");document.getElementById("updateuserloc").addEventListener("click",function(n){spiceGeo.GetGeoLocIntoFields(function(){spiceforms.PostUserFormAjax()});n.preventDefault()});Date.now||(Date.now=function(){return(new Date).getTime()});spiceGeo=function(){function n(n){return document.getElementById(n)}function f(){for(var t=document.querySelectorAll(".posfallback"),n=0;n<t.length;++n)t[n].className=""}function e(t,e){function l(){o.style.display="none";o.textContent="";clearInterval(c)}var s;if(i!==null&&r!==null&&u!==null&&(Date.now()-u)/1e3<120){n("lat").value=i;n("lon").value=r;s=n("locationaction");s!==null&&(s.style.display="");t();return}var h=!1,c=null,o=n("geowait");setTimeout(function(){h||(o.style.display="",o.textContent="Finding your location. Remember to accept if your device asks for permision to share your location.",c=setInterval(function(){o.textContent=o.textContent+"."},350))},300);navigator.geolocation.getCurrentPosition(function(f){h=!0;l();n("lat").value=f.coords.latitude;n("lon").value=f.coords.longitude;var e=n("locationaction");e!==null&&(e.style.display="");t();i=f.coords.latitude;r=f.coords.longitude;u=Date.now()},function(){l();n("geoerror").style.display="";f();e!==undefined&&e()},{enableHighAccuracy:!1,timeout:5e3,maximumAge:Infinity})}var t;"geolocation"in navigator?(t=n("jslocation"),t!==null&&t!==undefined&&(t.className="")):f();var i=null,r=null,u=null;return{GetGeoLocIntoFields:e}}(),function(){setTimeout(function(){var n=new XMLHttpRequest;n.open("GET","/api/prune?v="+Math.random());n.send(null);n.onreadystatechange=function(){var r,t,i;n.readyState===4&&n.status===200&&(r=document.getElementById("resetinfo"),r.innerHTML=n.responseText,t=document.createElement("script"),t.type="text/javascript",t.async=!0,t.src="/jsmin/lazy.min.js",i=document.getElementsByTagName("script")[0],i.parentNode.insertBefore(t,i))}},1)}();jsfl=!0;